!function(e){var t={};function a(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=t,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(r,n,function(t){return e[t]}.bind(null,n));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=1)}([,function(e,t,a){"use strict";function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}a.r(t),a.d(t,"showEventCreator",(function(){return l})),a.d(t,"buildEventPopup",(function(){return i})),a.d(t,"createDateAsUTC",(function(){return o}));var n=!1,l=function(e,t){n||(n=!0,$("<div />").qtip({content:{text:$("#event-creator"),title:Craft.t("calendar","New Event")},position:{my:"center",at:"center",target:$(window)},show:{ready:!0,modal:{on:!0,blur:!0}},hide:!1,style:{classes:"qtip-bootstrap dialogue",width:500},events:{render:function(a,n){var l=n.elements.content;$("ul.errors",l).empty();var i=e.utc().format("HHmmss"),d=t.utc().format("HHmmss"),s=!1;i===d&&"000000"===d&&(t.subtract(1,"seconds"),s=!0);var c=o(e.toDate()),u=o(t.toDate()),p=$("#event-creator"),f=$('input[name="startDate[date]"]',p),m=$('input[name="startDate[time]"]',p),v=$('input[name="endDate[date]"]',p),h=$('input[name="endDate[time]"]',p);p.addClass("shown"),f.datepicker("setDate",c),v.datepicker("setDate",u),m.timepicker("setTime",c),h.timepicker("setTime",u);var b=$("input[name=allDay]"),C=b.parents(".lightswitch:first");$("input",C).val(s?1:""),s?(C.data("lightswitch").turnOn(),$(".timewrapper",p).hide()):(C.data("lightswitch").turnOff(),$(".timewrapper",p).show()),setTimeout((function(){$("input[name=title]:first",l).val("").focus().bind("keypress",(function(e){13===(e.which?e.which:e.keyCode)&&$("button.submit",l).trigger("click")}))}),100);var y=m.timepicker("option","timeFormat").replace("h","hh").replace("H","HH").replace("G","H").replace("g","h").replace("A","a").replace("i","mm");$("button.submit",l).unbind("click").click((function(e){var t=$(this),a=$("input[name=title]",l).val(),i=$("select[name=calendarId]",l).val(),o=moment(f.datepicker("getDate")),d=moment(m.val().replace(/(a|p)\.(m)\./gi,"$1$2"),y),s=moment(v.datepicker("getDate")),c=moment(h.val().replace(/(a|p)\.(m)\./gi,"$1$2"),y);t.prop("disabled",!0).addClass("disabled"),t.text(Craft.t("app","Saving...")),$.ajax({url:Craft.getCpUrl("calendar/events/api/create"),type:"post",dataType:"json",data:r({startDate:o.format("YYYY-MM-DD")+" "+d.format("HH:mm:ss"),endDate:s.format("YYYY-MM-DD")+" "+c.format("HH:mm:ss"),allDay:b.val(),event:{title:a,calendarId:i}},Craft.csrfTokenName,Craft.csrfTokenValue),success:function(a){if(a.error)$("ul.errors",l).empty().append($("<li />",{text:a.error}));else if(a.event){var r=a.event;r.allDay&&(r.end=moment(r.end).add(2,"s").utc().format()),$("*[data-calendar-instance]").fullCalendar("renderEvent",r),$("*[data-calendar-instance]").fullCalendar("unselect"),n.hide(e)}t.prop("disabled",!1).removeClass("disabled"),t.text(Craft.t("app","Save"))},error:function(e){Craft.cp.displayNotification("error",JSON.parse(message)),t.prop("disabled",!1).removeClass("disabled"),t.text(Craft.t("app","Saving..."))}})})),$("button.delete",l).unbind("click").click((function(e){n.hide()}))},hide:function(e,t){$("#event-creator").removeClass("shown").insertAfter($("#solspace-calendar")),$("*[data-calendar-instance]").fullCalendar("unselect"),n=!1,t.destroy()}}}))},i=function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e.calendar){var l=$("<div>",{class:"buttons"}),i=$("<div>"),o=$("<div>",{class:"calendar-data",html:'<span class="color-indicator" style="background-color: '+e.backgroundColor+';"></span> '+e.calendar.name}),d=moment(e.start),s=moment(e.end),c="dddd, MMMM D, YYYY";if(e.allDay)s.subtract(1,"days");else{var u="H:i"===a?"HH:mm":"h:mma";c=c+" [at] "+u}var p=$("<div>",{class:"event-date-range separator",html:'<div style="white-space: nowrap;"><label>'+Craft.t("calendar","Starts")+":</label> "+d.format(c)+'</div><div style="white-space: nowrap;"><label>'+Craft.t("calendar","Ends")+":</label> "+s.format(c)+"</div>"}),f="";e.repeats&&(f=$("<div>",{class:"event-repeats separator",html:"<label>"+Craft.t("calendar","Repeats")+":</label> "+e.readableRepeatRule})),e.editable&&(l.append($("<a>",{class:"btn small submit",href:Craft.getCpUrl("calendar/events/"+e.id+(n?"/"+e.site.handle:"")),text:Craft.t("calendar","Edit")})),l.append($("<a>",{class:"btn small delete-event",href:Craft.getCpUrl("calendar/events/api/delete"),text:Craft.t("calendar","Delete"),data:{id:e.id}})),e.repeats&&l.append($("<a>",{class:"btn small delete-event-occurrence",href:Craft.getCpUrl("calendar/events/api/delete-occurrence"),text:Craft.t("calendar","Delete occurrence"),data:{id:e.id,date:e.start.toISOString()}}))),t.qtip({content:{title:e.title,button:!0,text:i.add(o).add(p).add(f).add(l)},style:{classes:"qtip-bootstrap qtip-event",tip:{width:30,height:15}},position:{my:"right center",at:"left center",adjust:{method:"shift flip"}},show:{solo:!0,delay:500},hide:{fixed:!0,delay:300},events:{show:function(e,t){window.qTipsEnabled||e.preventDefault()},render:function(t,a){$("a.delete-event-occurrence",a.elements.content).click((function(e){var t=$(this).attr("href"),n=$(this).data("id"),l=$(this).data("date");return confirm(Craft.t("calendar","Are you sure?"))&&$.ajax({url:t,type:"post",dataType:"json",data:r({eventId:n,date:l},Craft.csrfTokenName,Craft.csrfTokenValue),success:function(e){if(!e.error)return $("*[data-calendar-instance]").fullCalendar("refetchEvents"),void a.destroy();console.warn(e.error)}}),!1})),$("a.delete-event",a.elements.content).click((function(t){var n=$(this).attr("href"),l=$(this).data("id");return confirm(Craft.t("calendar","Are you sure you want to delete this event?"))&&$.ajax({url:n,type:"post",dataType:"json",data:r({eventId:l},Craft.csrfTokenName,Craft.csrfTokenValue),success:function(t){if(!t.error)return $("*[data-calendar-instance]").fullCalendar("removeEvents",e.id),void a.destroy();console.warn(t.error)}}),!1}))}}})}},o=function(e){return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds())}}]);