"use strict";function _slicedToArray(e,a){return _arrayWithHoles(e)||_iterableToArrayLimit(e,a)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,a){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var t=[],n=!0,r=!1,l=void 0;try{for(var i,d=e[Symbol.iterator]();!(n=(i=d.next()).done)&&(t.push(i.value),!a||t.length!==a);n=!0);}catch(c){r=!0,l=c}finally{try{n||null==d["return"]||d["return"]()}finally{if(r)throw l}}return t}}function _arrayWithHoles(e){if(Array.isArray(e))return e}var viewSpecificOptions={week:{titleFormat:"MMMM D, YYYY",columnFormat:"ddd D",timeFormat:"LT",slotLabelFormat:"LT"},day:{titleFormat:"dddd, MMMM D, YYYY",columnFormat:"",timeFormat:"LT",slotLabelFormat:"LT"}},selectedCalendarsStorageKey="calendar-selectedCalendars",qTipsEnabled=!0,$calendar=$("#solspace-calendar"),$miniCal=$("#calendar-mini-cal");$(function(){var e=$calendar.data(),a=e.currentDay,t=e.siteMap,n=e.overlapThreshold,r=e.language,l=e.firstDayOfWeek,i=$calendar.data(),d=i.currentSiteId,c=i.canEditEvents,s=i.canQuickCreate,o=i.isMultiSite;c=void 0!==c,s=void 0!==s,o=void 0!==o;var u={datepicker:{text:Craft.t("calendar","Pick a Date"),icon:"calendar",click:function(){var e=$(".fc-datepicker-button:first"),a=e.offset(),t=a.top,n=a.left,r=e.outerHeight();e.datepicker("dialog",$calendar.fullCalendar("getDate").format("YYYY-MM-DD"),function(e){var a=$calendar.fullCalendar("getView").type,t=/^(\d{4})-(\d{2})-(\d{2})$/.exec(e),n=_slicedToArray(t,4),r=(n[0],n[1]),l=n[2],i=n[3],d="month";switch(a){case"agendaDay":d="day";break;case"agendaWeek":d="week"}var c=Craft.getCpUrl("calendar/view/"+d+"/"+r+"/"+l+"/"+i);history.pushState("data","",c),$calendar.fullCalendar("gotoDate",e)},{dateFormat:"yy-mm-dd"},[n,t+r]),$("#ui-datepicker-div.ui-datepicker-dialog + input[id^=dp]").css({visibility:"hidden"})}},refresh:{text:Craft.t("calendar","Refresh"),click:function(){$calendar.fullCalendar("refetchEvents")}},Today:{text:Craft.t("calendar","Today"),click:function(){$calendar.fullCalendar("today")}}};o&&(u.siteButton={text:t[d],click:function(e){var a=$(".fc-siteButton-button",$calendar);if(void 0===a.data("initialized")){var n=$("<div>",{"class":"menu"}).insertAfter(e.currentTarget),r=$("<ul>").appendTo(n);for(var l in t)t.hasOwnProperty(l)&&$("<li>").append($("<a>",{"data-site-id":l,text:t[l]})).appendTo(r);new Garnish.MenuBtn(e.currentTarget,{onOptionSelect:function(e){var n=$(e).data("site-id");$calendar.data("current-site-id",n),a.text(t[n]),$calendar.fullCalendar("refetchEvents")}}).showMenu(),a.data("initialized",!0)}}}),$calendar.fullCalendar({now:new moment,defaultDate:a,defaultView:$calendar.data("view"),nextDayThreshold:"0"+n+":00:01",fixedWeekCount:!0,eventLimit:5,aspectRatio:1.3,editable:c,lang:r,views:viewSpecificOptions,firstDay:l,viewRender:renderView,events:getEvents,eventRender:renderEvent,dayRender:renderDay,eventDragStart:closeAllQTips,eventDragStop:enableQTips,eventDrop:eventDateChange,eventResizeStart:closeAllQTips,eventResizeStop:enableQTips,eventResize:eventDurationChange,selectable:s&&c,selectHelper:s&&c,select:showEventCreator,unselectAuto:!1,customButtons:u,header:{right:"siteButton refresh datepicker prev,Today,next",left:"title"}}),"month"!==$calendar.fullCalendar("getView").name&&$calendar.fullCalendar("option","height","auto"),$(".fc-next-button, .fc-prev-button, .fc-today-button",$calendar).on({click:function(){var e=$calendar.fullCalendar("getView").type,a=$calendar.fullCalendar("getDate"),t=a.format("YYYY"),n=a.format("MM"),r=a.format("DD"),l="month";switch(e){case"agendaDay":l="day";break;case"agendaWeek":l="week"}var i=Craft.getCpUrl("calendar/view/"+l+"/"+t+"/"+n+"/"+r);history.pushState("data","",i)}}),$(".alert-dismissible a.close").on({click:function(){var e=$(this).parents(".alert:first");Craft.postActionRequest("calendar/view/dismiss-demo-alert",{},function(a){e.remove()})}}),$(".calendar-list input").on({change:function(){var e={};$("ul.calendar-list input").map(function(){e[$(this).val()]=$(this).is(":checked")}).get().join(),localStorage.setItem(selectedCalendarsStorageKey,JSON.stringify(e));var a=[];for(var t in e)e.hasOwnProperty(t)&&e[t]&&a.push(t);$miniCal.data("calendars",a.join(",")),$miniCal.fullCalendar("refetchEvents"),$calendar.fullCalendar("refetchEvents")}});var f=$("#event-creator"),p=$(".lightswitch",f);p.on({change:function(){var e=$(".timewrapper",f);$("input",this).val()?e.fadeOut("fast"):e.fadeIn("fast")}})});var selectedCalendars=localStorage.getItem(selectedCalendarsStorageKey);if(null!==selectedCalendars){var usedCalendarIds=[],allCalendarIds=$("ul.calendar-list input").map(function(){return parseInt($(this).val())}).get(),calendarMap={};"{"===selectedCalendars.substring(0,1)&&(calendarMap=JSON.parse(selectedCalendars));for(var index=0;index<allCalendarIds.length;index++){var calendarId=allCalendarIds[index];void 0===calendarMap[calendarId]?(calendarMap[calendarId]=!0,usedCalendarIds.push(calendarId)):calendarMap[calendarId]===!0&&usedCalendarIds.push(calendarId)}$miniCal.data("calendars",usedCalendarIds.join(",")),$miniCal.hasClass("fc")&&$miniCal.fullCalendar("refetchEvents"),$(".calendar-list input").each(function(){var e=$(this).val(),a=void 0===calendarMap[e]||calendarMap[e]===!0;$(this).prop("checked",a)})}