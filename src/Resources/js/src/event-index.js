"use strict";Craft.EventIndex=Craft.BaseElementIndex.extend({buttonGroup:null,init:function(t,e,n){this.on("selectSource",$.proxy(this,"updateButton")),this.on("selectSite",$.proxy(this,"updateButton")),this.base(t,e,n)},getDefaultSourceKey:function(){return this.base()},updateButton:function(){if(this.$source){this.resetMenuButton();var t,e,n=this.$source,r=n.data(),a=r.id,s=r.name,i=r.handle,o=r.key,u="*"===o,c=this.getValidSources().filter(function(t){return t.id!==a}),d=$("<div />",{"class":"btngroup submit"}),l=this.createMenuList(c),h="btn submit";u?(t=Craft.t("calendar","New Event"),h+=" menubtn"):(t=Craft.t("calendar","New {calendar} Event",{calendar:s}),h+=" add icon",e=this.getSourceUrl(i));var f=$("<a />",{"class":h,href:e,text:Craft.escapeHtml(t)}).appendTo(d);l.appendTo(d);var p=f;!u&&c.length>0&&(p=$("<div />",{"class":"btn submit menubtn"}).insertBefore(l)),new Garnish.MenuBtn(p),this.buttonGroup=d,this.addButton(this.buttonGroup)}},resetMenuButton:function(){this.buttonGroup&&this.buttonGroup.remove()},createMenuList:function(t){for(var e=$("<div />",{"class":"menu"}),n=$("<ul />").appendTo(e),r=0;r<t.length;r++){var a=t[r],s=a.name,i=a.handle,o=a.color,u=$("<li />");$("<a />",{href:this.getSourceUrl(i),text:Craft.escapeHtml(s)}).prepend($("<span />",{"class":"color-indicator"}).css({backgroundColor:o})).appendTo(u),u.appendTo(n)}return e},getValidSources:function(){for(var t=this.$sources,e=[],n=0;n<t.length;n++){var r=$(t[n]),a=r.data(),s=a.key,i=a.id,o=a.handle,u=a.name,c=a.color,d=a.sites,l=void 0===d?"":d;if("*"!==s){var h="".concat(l).split(",").map(function(t){return parseInt(t)});h.indexOf(this.siteId)!==-1&&e.push({key:s,id:i,handle:o,name:u,color:c})}}return e},getSourceUrl:function(t){for(var e=0;e<Craft.sites.length;e++){var n=Craft.sites[e];if(n.id===this.siteId)return Craft.getUrl("calendar/events/new/".concat(t,"/").concat(n.handle))}}}),Craft.registerElementIndexClass("Solspace\\Calendar\\Elements\\Event",Craft.EventIndex);